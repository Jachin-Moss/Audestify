<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }
    .container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-gap: 20px;
        padding: 20px;
    }
    .card {
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        border-radius: 5px;
        padding: 20px;
        background-color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        height: 350px;
    }
    .card:hover {
        transform: translateY(-5px);
    }
    .status-icon {
        height: 15px;
        width: 15px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 5px;
        vertical-align: middle;
    }
    .connected {
        background-color: #28a745; /* Green for connected */
    }
    .not-connected {
        background-color: #dc3545; /* Red for not connected */
    }
    .sync-btn {
        padding: 10px 20px;
        background-color: #4267B2;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 15px;
    }
    .sync-btn:hover {
        background-color: #365899;
    }
    .fa-facebook-f { color: #4267B2; }
    .fa-tiktok { color: #000; }
    .fa-twitter { color: #1DA1F2; }
    .fa-linkedin-in { color: #0077B5; }
    .fa-youtube { color: #FF0000; }
    .fa-sync { animation: spin 2s linear infinite; }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .status-text {
        margin-top: 10px;
        font-size: 0.9em;
        color: #555;
    }
</style>

<div class="container">
    <!-- Facebook Card -->
    <div class="card" id="facebook-card">
        <i class="fab fa-facebook-f fa-3x mb-3"></i>
        <div id="facebook-status" class="status-icon not-connected"></div>
        <button class="sync-btn" onclick="checkLoginState();">Sync Now</button>
        <p id="facebook-status-text" class="status-text hidden">Not Connected</p>
    </div>
    <!-- Other Social Media Cards -->
    <div class="card">
        <i class="fab fa-tiktok fa-3x mb-3"></i>
        <div class="status-icon not-connected"></div>
        <button class="sync-btn">Sync Now</button>
        <p class="status-text">Not Connected</p>
    </div>
    <div class="card">
        <i class="fab fa-twitter fa-3x mb-3"></i>
        <div class="status-icon not-connected"></div>
        <button class="sync-btn">Sync Now</button>
        <p class="status-text">Not Connected</p>
    </div>
    <!-- Add additional cards for other social media platforms as needed -->
</div>

<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
<script>
    window.fbAsyncInit = function() {
        FB.init({
            appId      : '454640906893151', // Replace with your Facebook App ID
            cookie     : true,
            xfbml      : true,
            version    : 'v19.0' // Use the correct Graph API version for your app
        });

        FB.AppEvents.logPageView();
         checkLoginState();
    };

    function checkLoginState() {
        FB.getLoginStatus(function(response) {
            if (response.status !== 'connected') {
                // If not already connected, explicitly call the login method
                FB.login(function(response) {
                    statusChangeCallback(response);
                }, {scope: 'public_profile,email'});
            } else {
                // If already connected, handle the status change
                statusChangeCallback(response);
            }
        });
    }

function createSocialMediaAccount(authToken) {
    if (authToken) {
        // Hna authToken will be sent to the backend
        $.ajax({
            url: '/social_media_accounts',
            type: 'POST',
            data: { auth_token: authToken },
            success: function(response) {
                console.log('Social media account created successfully:', response);
                // Dazet
            },
            error: function(error) {
                console.error('Error creating social media account:', error);
                // Madazetch
            }
        });
    } else {
        console.error('No auth token found');
    }
}

function statusChangeCallback(response) {
        var facebookStatusText = document.getElementById("facebook-status-text");

        if (response.status === 'connected') {
            // The user is logged in and has authenticated your app

            console.log('Facebook Access Token:', response.authResponse.accessToken);
            facebookStatusText.classList.remove("hidden");
            facebookStatusText.innerHTML = 'Checking...';
            FB.api('/me', function(response) {
                facebookStatusText.innerHTML = 'Logged in as ' + response.name;
            });
            // Change the status icon and button
            document.getElementById("facebook-status").classList.remove("not-connected");
            document.getElementById("facebook-status").classList.add("connected");
            var fbCard = document.getElementById("facebook-card");
            fbCard.querySelector('.sync-btn').classList.add("hidden");
            createSocialMediaAccount(response.auth.accessToken);
        } else {
            // The person is not logged into your app or we are unable to tell.
            facebookStatusText.classList.remove("hidden");
            facebookStatusText.innerHTML = 'Not Connected';
            document.getElementById("facebook-status").classList.remove("connected");
            document.getElementById("facebook-status").classList.add("not-connected");
            var fbCard = document.getElementById("facebook-card");
            fbCard.querySelector('.sync-btn').classList.remove("hidden");
        }
    }


</script>
